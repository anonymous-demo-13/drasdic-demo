<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>DRASDIC Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: Arial, sans-serif;
      margin-top: 20px;
    }
    .card {
      margin-bottom: 30px;
    }
    .waveform, .spectrogram {
      width: 100%;
      border: 1px solid #ddd;
      margin-bottom: 10px;
    }
    .waveform {
      height: 128px;
    }
    .spectrogram {
      height: 256px;
    }
    .play-btn {
      margin-bottom: 10px;
    }
  </style>
</head>
<body>
  <div class="container my-5">
    <!-- Paper Card -->
    <div class="card shadow-sm mb-4">
      <div class="card-body">
        <h3 class="card-title">Synthetic data enables context‐aware bioacoustic sound event detection.</h3>
        <p class="card-text">
          We propose a methodology for training foundation models that enhances their in‐context learning capabilities within the domain of bioacoustic signal processing.
          Using synthetically generated training data and a domain‐randomization pipeline, we construct diverse acoustic scenes with temporally strong labels.
          Our model significantly outperforms previous methods and is available via an API to support conservation and biodiversity monitoring.
        </p>
      </div>
    </div>

    <!-- Synthetic Training Audio Card -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Examples: Synthetic Training Audio</h4>
        <small class="text-light">The first thirty seconds is the support audio, and the remaining ten seconds is the query.</small>
      </div>
      <div class="card-body">
        <div class="row">
          <!-- Synthetic Audio 1 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Synthetic Audio 1</div>
              <div class="card-body">
                <button id="synth-play-1" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="synth-waveform-1" class="waveform"></div>
                <div id="synth-spectrogram-1" class="spectrogram"></div>
              </div>
            </div>
          </div>
          <!-- Synthetic Audio 2 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Synthetic Audio 2</div>
              <div class="card-body">
                <button id="synth-play-2" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="synth-waveform-2" class="waveform"></div>
                <div id="synth-spectrogram-2" class="spectrogram"></div>
              </div>
            </div>
          </div>
          <!-- Synthetic Audio 3 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Synthetic Audio 3</div>
              <div class="card-body">
                <button id="synth-play-3" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="synth-waveform-3" class="waveform"></div>
                <div id="synth-spectrogram-3" class="spectrogram"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- FASD13 Benchmark Card -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Examples: FASD13 Benchmark</h4>
        <small class="text-light">Newly released bioacoustic datasets</small>
      </div>
      <div class="card-body">
        <!-- Carrion Crows Subsection -->
        <h5 class="mb-3">Newly Released: Carrion Crows</h5>
        <div class="row">
          <!-- Carrion Crows Example 1 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Carrion Crows Example 1</div>
              <div class="card-body">
                <button id="carrion-play-1" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="carrion-waveform-1" class="waveform"></div>
                <div id="carrion-spectrogram-1" class="spectrogram"></div>
              </div>
            </div>
          </div>
          <!-- Carrion Crows Example 2 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Carrion Crows Example 2</div>
              <div class="card-body">
                <button id="carrion-play-2" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="carrion-waveform-2" class="waveform"></div>
                <div id="carrion-spectrogram-2" class="spectrogram"></div>
              </div>
            </div>
          </div>
        </div>
        <!-- Jumping Spiders Subsection -->
        <h5 class="mb-3 mt-4">Newly Released: Jumping Spiders</h5>
        <div class="row">
          <!-- Jumping Spiders Example 1 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Jumping Spiders Example 1</div>
              <div class="card-body">
                <button id="spiders-play-1" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="spiders-waveform-1" class="waveform"></div>
                <div id="spiders-spectrogram-1" class="spectrogram"></div>
              </div>
            </div>
          </div>
          <!-- Jumping Spiders Example 2 -->
          <div class="col-12">
            <div class="card mb-3">
              <div class="card-header">Jumping Spiders Example 2</div>
              <div class="card-body">
                <button id="spiders-play-2" class="btn btn-primary btn-sm play-btn">Play</button>
                <div id="spiders-waveform-2" class="waveform"></div>
                <div id="spiders-spectrogram-2" class="spectrogram"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Cluster Examples Section -->
    <div class="card shadow-sm mb-4">
      <div class="card-header bg-primary text-white">
        <h4 class="mb-0">Cluster Examples</h4>
        <small class="text-light">Sound event clusters
          used in synthetic audio generation </small>
      </div>
      <div class="card-body" id="cluster-examples">
        <!-- Cluster cards will be added here dynamically -->
      </div>
    </div>

  </div>
  
  <!-- WaveSurfer v6.6.2 UMD and Plugins -->
  <script src="https://unpkg.com/wavesurfer.js@6.6.2"></script>
  <script src="https://unpkg.com/wavesurfer.js@6.6.2/dist/plugin/wavesurfer.regions.min.js"></script>
  <script src="https://unpkg.com/wavesurfer.js@6.6.2/dist/plugin/wavesurfer.spectrogram.min.js"></script>
  
  <!-- Existing Audio Demo Instances -->
  <script>
    /**
     * Helper function to create a WaveSurfer demo instance with selection tables.
     */
    function createAudioDemo(options) {
      const { playButtonId, waveformId, spectrogramId, audioPath, selectionTablePath } = options;
      
      const ws = WaveSurfer.create({
        container: '#' + waveformId,
        waveColor: '#cccccc',
        progressColor: '#555555',
        backend: 'MediaElement',
        height: 128,
        plugins: [
          WaveSurfer.regions.create({}),
          WaveSurfer.spectrogram.create({
            container: '#' + spectrogramId,
            labels: true,
            height: 256
          })
        ]
      });
      
      ws.load(audioPath);
      
      ws.on('ready', () => {

        if (audioPath.includes('synthetic') || audioPath.includes('audio_2')) {
          // Add the "support" region for the first 30 seconds
          ws.addRegion({
            start: 0,
            end: 30,
            color: 'rgba(0, 123, 255, 0.3)', // Blueish for support
            data: { label: 'Support' }
          });
          
          // Add the "query" region for the final 10 seconds (30s to 40s)
          ws.addRegion({
            start: 30,
            end: 40,
            color: 'rgba(220, 53, 69, 0.3)', // Reddish for query
            data: { label: 'Query' }
          });
        }

        fetch(selectionTablePath)
          .then(resp => resp.text())
          .then(text => {
            const lines = text.split('\n').map(l => l.trim()).filter(Boolean);
            if (lines[0] && lines[0].toLowerCase().includes('begin')) {
              lines.shift();
            }
            lines.forEach(line => {
              const parts = line.split(/\s+/);
              if (parts.length >= 2) {
                const start = parseFloat(parts[0]);
                const end = parseFloat(parts[1]);
                const label = parts[2] || 'Unknown';
                ws.addRegion({
                  start: start,
                  end: end,
                  color: 'rgba(255, 0, 0, 0.3)',
                  data: { annotation: label }
                });
              }
            });
          })
          .catch(err => console.error('Error loading selection table:', err));
      });
      
      const playBtn = document.getElementById(playButtonId);
      playBtn.addEventListener('click', () => {
        ws.playPause();
        playBtn.textContent = ws.isPlaying() ? 'Pause' : 'Play';
      });
      
      ws.on('audioprocess', currentTime => {
        Object.values(ws.regions.list).forEach(region => {
          if (currentTime >= region.start && currentTime <= region.end) {
            region.update({ color: 'rgba(0, 255, 0, 0.4)' });
          } else {
            region.update({ color: 'rgba(255, 0, 0, 0.3)' });
          }
        });
      });
      
      ws.on('finish', () => {
        playBtn.textContent = 'Play';
      });
    }
    
    // Synthetic Audios
    createAudioDemo({
      playButtonId: 'synth-play-1',
      waveformId: 'synth-waveform-1',
      spectrogramId: 'synth-spectrogram-1',
      audioPath: 'audio/synthetic_02.wav',
      selectionTablePath: 'audio/selection_table_synthetic_02.txt',
    });
    createAudioDemo({
      playButtonId: 'synth-play-2',
      waveformId: 'synth-waveform-2',
      spectrogramId: 'synth-spectrogram-2',
      audioPath: 'audio/audio_25.wav',
      selectionTablePath: 'audio/selection_table_25.txt'
    });
    createAudioDemo({
      playButtonId: 'synth-play-3',
      waveformId: 'synth-waveform-3',
      spectrogramId: 'synth-spectrogram-3',
      audioPath: 'audio/audio_27.wav',
      selectionTablePath: 'audio/selection_table_27.txt'
    });
    
    // Test Audios: Carrion Crows
    createAudioDemo({
      playButtonId: 'carrion-play-1',
      waveformId: 'carrion-waveform-1',
      spectrogramId: 'carrion-spectrogram-1',
      audioPath: 'audio/carrion_crow_19_AL_Azul_1015truncated_clip_30s.wav',
      selectionTablePath: 'audio/cc_19_azul_parsed.txt'
    });
    createAudioDemo({
      playButtonId: 'carrion-play-2',
      waveformId: 'carrion-waveform-2',
      spectrogramId: 'carrion-spectrogram-2',
      audioPath: 'audio/carrion_crow_19_AL_Naranja_30s.wav',
      selectionTablePath: 'audio/cc_19_naranja_parsed.txt'
    });
    
    // Test Audios: Jumping Spiders
    // Uncomment if needed.
    createAudioDemo({
      playButtonId: 'spiders-play-1',
      waveformId: 'spiders-waveform-1',
      spectrogramId: 'spiders-spectrogram-1',
      audioPath: 'audio/Spiders_01.wav',
      selectionTablePath: 'audio/Spiders_007_parsed.txt'
    });
    createAudioDemo({
      playButtonId: 'spiders-play-2',
      waveformId: 'spiders-waveform-2',
      spectrogramId: 'spiders-spectrogram-2',
      audioPath: 'audio/Spiders_02.wav',
      selectionTablePath: 'audio/Spiders_011_parsed.txt'
    });
  </script>
  
  <!-- Simple Audio Demo for Cluster Examples (no regions) -->
  <script>
    /**
     * Helper function to create a simplified WaveSurfer instance (without selection table).
     */
    function createSimpleAudioDemo(options) {
      const { playButtonId, waveformId, audioPath } = options;
      const ws = WaveSurfer.create({
        container: '#' + waveformId,
        waveColor: '#cccccc',
        progressColor: '#555555',
        backend: 'MediaElement',
        height: 128,
      });
      ws.load(audioPath);
      
      const playBtn = document.getElementById(playButtonId);
      playBtn.addEventListener('click', () => {
        ws.playPause();
        playBtn.textContent = ws.isPlaying() ? 'Pause' : 'Play';
      });
      ws.on('finish', () => {
        playBtn.textContent = 'Play';
      });
    }
    
    // Hard-coded list of clusters and their audio filenames.
    // Update this array with your actual cluster IDs and file names.
    const clusterData = [
      {
        id: "cluster_21571",
        files: [
          "1_Dactylortyx.thoracicus8902-1b_source0_clip3.wav",
          "2_Dactylortyx.thoracicus8902-1b_source0_clip4.wav",
          "3_Dactylortyx.thoracicus8902-1b_source0_clip5.wav",
          // "4_Dactylortyx.thoracicus8902-1b_source0_clip6.wav"
        ]
      },
      {
        id: "cluster_21141",
        files: [
          "1_CARMAG09_source3_clip21.wav",
          "2_Carduelis_carduelis_PF00658_short_source0_clip27.wav",
          "3_SISKIN_Hooded_02_Reserva_Costanera_Sur_Buenos_Aires_AR_9SEP05_Carlos_Ferrari_source0_clip20.wav",
          // "4_XC137778-OCHRACEOUS_WREN_Santa_Elena_CF_Costa_Rica_3.59pm_05282013_source1_clip2.wav"
        ]
      },
      {
        id: "cluster_20455",
        files: [
          "1_906._Bocages_BushShrike_Kakamega_7Apr12_1110_source0_clip0.wav",
          "2_906._Bocages_BushShrike_Kakamega_7Apr12_1110_source0_clip1.wav",
          "3_906._Bocages_BushShrike_Kakamega_7Apr12_1110_source0_clip2.wav",
          // "4_906._Bocages_BushShrike_Kakamega_7Apr12_1110_source0_clip3.wav"
        ]
      }
];

    
    // Iterate over clusterData to dynamically add cluster example cards.
    const clusterContainer = document.getElementById("cluster-examples");
    clusterData.forEach(cluster => {
      // Create a card for this cluster.
      const card = document.createElement("div");
      card.className = "card shadow-sm mb-4";
      const cardHeader = document.createElement("div");
      cardHeader.className = "card-header bg-primary text-white";
      cardHeader.innerHTML = `<h4 class="mb-0">${cluster.id}</h4>`;
      card.appendChild(cardHeader);
      
      const cardBody = document.createElement("div");
      cardBody.className = "card-body";
      
      // For each audio file in this cluster, create a demo.
      cluster.files.forEach((file, index) => {
        const demoDiv = document.createElement("div");
        demoDiv.className = "mb-3";
        // Unique IDs for the play button and waveform container.
        const playButtonId = `cluster-${cluster.id}-play-${index}`;
        const waveformId = `cluster-${cluster.id}-waveform-${index}`;
        demoDiv.innerHTML = `
          <div class="card">
            <div class="card-header">Audio ${index + 1}</div>
            <div class="card-body">
              <button id="${playButtonId}" class="btn btn-primary btn-sm play-btn">Play</button>
              <div id="${waveformId}" class="waveform"></div>
            </div>
          </div>
        `;
        // Inside your clusterData.forEach loop, for each file:
        cardBody.appendChild(demoDiv);
        // Delay the WaveSurfer instance creation until the container is in the DOM.
        setTimeout(() => {
        createSimpleAudioDemo({
          playButtonId: playButtonId,
          waveformId: waveformId,
          audioPath: `/audio/clusters/${cluster.id}/${file}`
        });

        }, 0);

      });
      
      card.appendChild(cardBody);
      clusterContainer.appendChild(card);
    });
  </script>
  
  <!-- Bootstrap Bundle JS (Optional for interactive components) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
